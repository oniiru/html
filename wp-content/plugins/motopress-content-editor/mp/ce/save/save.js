steal("jquery/class",function($){$.Class("CE.Save",{isContentChanged:false,save:function(){this.isContentChanged=false;this.convertAndInsert()},convertAndInsert:function(){var dom=CE.Iframe.contents.find("body .motopress-content-wrapper");var src="";src=this.getSources(src,dom);tinyMCE.get("content").setContent(src,{format:"html"})},getSources:function(src,dom,level){if(typeof level==="undefined"){level=1}var $this=this;var mpRow,mpSpan;if(level===1){mpRow="mp_row";mpSpan="mp_span"}else{mpRow="mp_row_inner";mpSpan="mp_span_inner"}dom.children(".mp-row-fluid.motopress-row").each(function(){src+="<p>["+mpRow+"]</p>";$(this).children('[class*="span"].motopress-span').each(function(){var col=MP.Utils.getSpanNumber($(this).attr("class"));var classes="";var style="";if($(this).hasClass("motopress-empty")){classes=' classes="motopress-empty"'}if($(this).hasClass("motopress-space")){classes=' classes="motopress-space"'}var minHeight=parseInt($(this).css("min-height"));if(minHeight!==CE.Iframe.window.CE.Resizer.myThis.minHeight&&minHeight!==CE.Iframe.window.CE.Resizer.myThis.spaceMinHeight){style=' style="min-height: '+$(this).css("min-height")+';"'}src+="<p>["+mpSpan+' col="'+col+'"'+classes+style+"]</p>";if($(this).children(".mp-row-fluid.motopress-row").length){src=$this.getSources(src,$(this),++level)}else{src=$this.getShortcode(src,$(this))}src+="<p>[/"+mpSpan+"]</p>"});src+="<p>[/"+mpRow+"]</p>"});return src},getShortcode:function(src,span){var shortcode=span.find(".motopress-block-content > [data-motopress-shortcode]");if(shortcode.length){var shortcodeSrc="";var name=shortcode.attr("data-motopress-shortcode");var params=shortcode.attr("data-motopress-parameters");var closeType=shortcode.attr("data-motopress-close-type");var unwrap=(typeof shortcode.attr("data-motopress-unwrap")==="undefined")?false:true;var start="";var end="";if(closeType==="enclosed"){var content=shortcode.attr("data-motopress-content");content=(!content)?"":content.replace(/\[\]/g,"[");shortcodeSrc+=content;end="<p>[/"+name+"]</p>"}if(!unwrap){start="<p>["+name;if(params){params=JSON.parse(params);$.each(params,function(key,attrs){if(typeof attrs.value!=="undefined"&&attrs.value!==""){start+=" "+key+'="'+attrs.value+'"'}})}start+="]</p>";shortcodeSrc=start+shortcodeSrc+end}src+=shortcodeSrc}return src},changeContent:function(){if(!this.isContentChanged){var wpEditor=parent.CE.CodeModal.myThis.wpEditor;if(wpEditor){var contentSrc=wpEditor.getContent({format:"html"});contentSrc+="MOTOPRESS_"+MP.Utils.uniqid();wpEditor.setContent(contentSrc,{format:"html"});wpEditor.focus();this.isContentChanged=true}}}},{})});