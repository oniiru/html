steal("jquery/controller",function($){$.Controller("CE.Ctrl",{processValue:function(value,defaultValue,isNew){return String(value=((typeof isNew!=="undefined"&&isNew&&typeof value==="undefined")||!value)?defaultValue:value)}},{name:null,init:function(el,args){this.name=args.name},change:function(el,e){CE.Dialog.myThis.currentSpan.ce_controls("saveData",this)}});CE.Ctrl("CE.CtrlInput",{},{get:function(){return this.element.attr("value")},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.attr("value",value)}});CE.Ctrl("CE.CtrlTextarea",{},{get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.val(value)}});CE.Ctrl("CE.CtrlImageGeneral",{listensTo:["dialogOpen"]},{autoOpened:false,init:function(el,args){this._super(el,args);if(!args.isNew){this.autoOpened=true}}});CE.CtrlImageGeneral("CE.CtrlImage",{thumbnail:parent.MP.Settings.pluginRootUrl+"/"+parent.MP.Settings.pluginName+"/images/ce/imageThumbnail.png"+parent.motopress.pluginVersionParam},{id:null,init:function(el,args){this._super(el,args)},dialogOpen:function(el){if(!this.autoOpened){el.find(".motopress-thumbnail-crop").trigger("click");this.autoOpened=true}},get:function(){return(this.id!==null)?this.id:""},set:function(value,defaultValue,isNew){if($.isPlainObject(value)&&value.hasOwnProperty("id")&&value.hasOwnProperty("src")){this.id=value.id;this.setThumbnail(value.src,defaultValue,isNew)}else{if($.isNumeric(value)){if(this.id===null){this.showPreloader();this.id=value;var ctrl=this;$.ajax({url:parent.motopress.ajaxUrl,type:"POST",dataType:"text",data:{action:"motopress_ce_get_attachment_thumbnail",nonce:parent.motopressCE.nonces.motopress_ce_get_attachment_thumbnail,postID:parent.motopressCE.postID,id:ctrl.id},success:function(data){ctrl.setThumbnail(data,defaultValue,isNew);ctrl.hidePreloader()},error:function(jqXHR){var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{parent.MP.Flash.setFlash(error.message,"error");parent.MP.Flash.showMessage()}ctrl.setThumbnail(CE.CtrlImage.thumbnail,defaultValue,isNew);ctrl.hidePreloader()}})}}}},setThumbnail:function(value,defaultValue,isNew){var val=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.find(".motopress-thumbnail").attr("src",val)},".motopress-thumbnail-crop click":function(el,e){if(!el.hasClass(CE.Shortcode.preloaderClass)){this.element.attr("data-motopress-open-img-lib",1);CE.ImageLibrary.myThis.frame.open()}},".motopress-icon-trash click":function(){this.id=null;this.element.find(".motopress-thumbnail").attr("src",CE.CtrlImage.thumbnail);this.hideTools();this.element.trigger("change")},showTools:function(){this.element.children(".motopress-image-tools").show()},hideTools:function(){this.element.children(".motopress-image-tools").hide()},showPreloader:function(){this.element.children(".motopress-thumbnail-crop").addClass(CE.Shortcode.preloaderClass).children(".motopress-thumbnail").css("visibility","hidden");this.hideTools()},hidePreloader:function(){var thumbnailCrop=this.element.children(".motopress-thumbnail-crop");var thumbnail=thumbnailCrop.children(".motopress-thumbnail");thumbnailCrop.removeClass(CE.Shortcode.preloaderClass);thumbnail.css("visibility","visible");if(thumbnail.attr("src")!==CE.CtrlImage.thumbnail){this.showTools()}}});CE.CtrlImageGeneral("CE.CtrlImageSlider",{},{ids:null,init:function(el,args){this._super(el,args)},dialogOpen:function(el){if(!this.autoOpened){el.trigger("click");this.autoOpened=true}},get:function(){return(this.ids!==null)?this.ids:""},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);var valueType=typeof value;if(valueType==="object"){var idsStr="";var idsLen=value.length;for(var i=0;i<idsLen;i++){if(i<idsLen-1){idsStr+=value[i]+","}else{idsStr+=value[i]}}this.ids=idsStr}else{if(valueType==="number"||valueType==="string"){this.ids=$.trim(value)}}},getArray:function(){var idsArr=new Array();if(this.ids){idsArr=this.ids.split(",");var id;for(var i=0;i<idsArr.length;i++){id=parseInt(idsArr[i],10);if(id){idsArr[i]=id}else{delete idsArr[i]}}}return idsArr},click:function(el){if(!el.hasClass(CE.Shortcode.preloaderClass)){CE.WPGallery.myThis.open(this)}}});CE.Ctrl("CE.CtrlVideo",{},{init:function(el,args){this._super(el,args);this.element.on("paste",function(){setTimeout(function(){el.blur()},0)})},get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.val(value)}});CE.Ctrl("CE.CtrlCheckbox",{},{get:function(){return this.element.is(":checked")},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);(value==="true")?this.element.attr("checked","checked"):this.element.removeAttr("checked")}});CE.Ctrl("CE.CtrlSelect",{listensTo:["customize"],init:function(){$("body").on("click",".motopress-property-select:not(.open) > .dropdown-toggle",function(){var menu=$(this).next();var lastIndex=menu.find("ul > li").length;lastIndex=(lastIndex>=6)?5:lastIndex-1;menu.find("li:eq("+lastIndex+") > a").focus();menu.find("ul > li > a.motopress-dropdown-selected").focus()})},setSelected:function(el){var options=el.find("option");var selectedIndex=options.index(options.filter(":selected"));var customOptions=el.next().find(".dropdown-menu > ul > li");customOptions.children("a.motopress-dropdown-selected").removeClass("motopress-dropdown-selected");customOptions.filter('[rel="'+selectedIndex+'"]').children("a").addClass("motopress-dropdown-selected")}},{get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.find('[value="'+value+'"]').attr("selected","selected")},change:function(el){this._super();CE.CtrlSelect.setSelected(el)},customize:function(el){if(typeof el.data("selectpicker")!=="undefined"){$.removeData(el[0],"selectpicker")}el.selectpicker({size:6});var customSelect=el.next();customSelect.removeClass("ce_ctrl_select motopress-controls");var dropdownToogle=customSelect.children(".dropdown-toggle");dropdownToogle.html(dropdownToogle.html().replace(/&nbsp;/g,""));CE.CtrlSelect.setSelected(el)}})});