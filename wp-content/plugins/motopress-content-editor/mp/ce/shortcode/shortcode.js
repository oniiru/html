steal("jquery/controller",function($){$.Controller("CE.Shortcode",{listensTo:["render"],preloaderClass:"motopress-small-preload"},{shortcode:null,init:function(el,args){this.shortcode=el.find(".motopress-block-content > [data-motopress-shortcode]")},renderShortcode:function(isNew){isNew=(typeof isNew==="undefined"||!isNew)?false:true;var $this=this;var handle=this.element.find(".motopress-drag-handle");handle.addClass(CE.Shortcode.preloaderClass);var closeType=this.shortcode.attr("data-motopress-close-type");var shortcode=this.shortcode.attr("data-motopress-shortcode");var parameters=(this.shortcode.attr("data-motopress-parameters")!=="undefined")?this.shortcode.attr("data-motopress-parameters"):null;var content=(this.shortcode.attr("data-motopress-content")!=="undefined")?this.shortcode.attr("data-motopress-content"):null;if(isNew&&parameters){var JSONParameters=$.parseJSON(parameters);$.each(JSONParameters,function(name,values){if(typeof values.value==="undefined"||!values.value){values.value=$this.generalAttrs[name]["default"]}});parameters=JSON.stringify(JSONParameters);this.setShortcodeAttrs(JSONParameters)}$.ajax({url:parent.motopress.ajaxUrl,type:"POST",dataType:"html",data:{action:"motopress_ce_render_shortcode",nonce:parent.motopressCE.nonces.motopress_ce_render_shortcode,postID:parent.motopressCE.postID,closeType:closeType,shortcode:shortcode,parameters:parameters,content:content},success:function(data){var span=$this.shortcode.closest('[class*="span"].motopress-span');if(!span.parent(".motopress-content-wrapper > .mp-row-fluid.motopress-row").length){var handleMiddleLast=span.parent(".mp-row-fluid.motopress-row").nextAll(".motopress-handle-middle-in:last");var minHeight=parseInt(handleMiddleLast.css("min-height"));handleMiddleLast.height(minHeight)}$this.shortcode.html(data);var images=$this.shortcode.find("img");var imgCount=images.length,count=0;if(imgCount){images.on("load",function(){count++;if(count===imgCount){$this.element.trigger("render")}})}$this.element.trigger("render");handle.removeClass(CE.Shortcode.preloaderClass);parent.CE.Save.changeContent()},error:function(jqXHR){var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{parent.MP.Flash.setFlash(error.message,"error");parent.MP.Flash.showMessage()}handle.removeClass(CE.Shortcode.preloaderClass)}})}})});