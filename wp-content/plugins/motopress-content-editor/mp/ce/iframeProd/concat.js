steal("jquery/controller","jquery/view/ejs").then("mp/ce/grid/views/init.ejs"+parent.motopress.pluginVersionParam,function($){$.Controller("CE.Grid",{myThis:null},{columnWidthPiece:null,columnMarginPiece:null,splitterWidthPiece:null,splitterMarginPiece:null,column:null,columnCount:12,columnWidthStatus:null,init:function(el){CE.Grid.myThis=this;el.html("//mp/ce/grid/views/init.ejs"+parent.motopress.pluginVersionParam,{columnCount:this.columnCount});this.column=el.find(".mp-span1:last");this.setSize();$(window).on("resize",this.proxy("setSize"))},setSize:function(){var columnWidthStatus=this.column.width();if(!this.columnWidthStatus||this.columnWidthStatus!==columnWidthStatus){this.columnWidthPiece=parseFloat(this.column.width());this.columnMarginPiece=parseFloat(this.column.css("margin-left"));this.splitterWidthPiece=this.columnMarginPiece/100*66.66666;this.splitterMarginPiece=this.columnMarginPiece/100*83.33333;if(this.columnWidthStatus){CE.Resizer.myThis.updateSplittableOptions(null,null,null,"init");CE.Resizer.myThis.updateSplitterHeight(null,"init")}this.columnWidthStatus=columnWidthStatus}}})});steal("jquery/class",function($){$.Class("CE.LeftBar",{myThis:null},{leftBar:$("<div />",{"class":"motopress-default",id:"motopress-content-editor-leftbar",tabIndex:-1}),group:$("<div />",{"class":"motopress-leftbar-group motopress-default"}),groupInner:$("<div />",{"class":"motopress-leftbar-group-inner motopress-default"}),groupIcon:$("<div />",{"class":"motopress-leftbar-group-icon"}),groupActive:$("<div />",{"class":"motopress-leftbar-group-active motopress-default"}),object:$("<div />",{"class":"motopress-ce-object motopress-default-drag"}),objectInner:$("<div />",{"class":"motopress-ce-object-inner motopress-default"}),objectDot:$("<div />",{"class":"motopress-ce-object-dot motopress-default"}),objectIcon:$("<div />",{"class":"motopress-ce-object-icon"}),objectName:$("<span />",{"class":"motopress-ce-object-name motopress-default motopress-no-color-text"}),library:null,setup:function(){this.getLibrary();this.groupIcon.append(this.groupActive).appendTo(this.groupInner);this.groupInner.append(this.groupPopover).appendTo(this.group);this.objectInner.append(this.objectDot,this.objectIcon,this.objectName).appendTo(this.object);this.leftBar.prependTo("body")},init:function(){CE.LeftBar.myThis=this},getLibrary:function(){$.ajax({url:parent.motopress.ajaxUrl,type:"POST",dataType:"json",data:{action:"motopress_ce_get_library",nonce:parent.motopressCE.nonces.motopress_ce_get_library,postID:parent.motopressCE.postID},success:function(data){CE.LeftBar.myThis.library=data;CE.LeftBar.myThis.createGroup();new CE.DragDrop();parent.CE.Navbar.myThis.preload(false)},error:function(jqXHR){parent.CE.Navbar.myThis.preload(false);var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{parent.MP.Flash.setFlash(error.message,"error");parent.MP.Flash.showMessage()}}})},createGroup:function(){if(this.library!==null&&!$.isEmptyObject(this.library)){for(var g in this.library){var group=this.group.clone();var icon=group.find(".motopress-leftbar-group-icon");icon.css("background-image","url("+this.library[g]["icon"]+")");group.clickover({html:true,animation:false,width:"210px",title:localStorage.getItem("addBlockTip"),content:this.createObject(this.library[g]["id"],this.library[g]["objects"]),onShown:function(){this.$tip.find(".arrow").removeClass("arrow").addClass("motopress-ce-arrow");var shadow=this.$element.is(":first-child")?5:0;var tipTop=parseInt(this.$tip.css("top"))+(parseInt(this.$tip.css("height"))/2)-23+shadow;this.$tip.css("top",tipTop);var tipTitle=this.$tip.find(".popover-title");tipTitle.addClass("motopress-default motopress-default-text");if(tipTitle.next(".popover-content").length){var tipContent=tipTitle.next();tipTitle.insertAfter(tipContent);tipContent.addClass("motopress-ce-object-container")}CE.DragDrop.myThis.makeDraggableNewBlock()},onHidden:function(){this.$element.find(".motopress-leftbar-group-active").removeClass("active")}});group.find(".motopress-leftbar-group-active").on("mousedown",function(e){e.preventDefault();e.stopPropagation()});group.appendTo(this.leftBar)}this.hoverActive()}},createObject:function(group,objects){if(!$.isEmptyObject(objects)){var result=$("<div />");for(var o in objects){var object=this.object.clone();object.attr({"data-motopress-close-type":objects[o]["closeType"],"data-motopress-shortcode":objects[o]["id"],"data-motopress-group":group});var parameters=objects[o]["parameters"];if(!$.isEmptyObject(parameters)){var parametersObj={};$.each(parameters,function(key){parametersObj[key]={}});object.attr("data-motopress-parameters",JSON.stringify(parametersObj))}var icon=object.find(".motopress-ce-object-icon");icon.css("background-image","url("+objects[o]["icon"]+")");var name=object.find(".motopress-ce-object-name");name.text(objects[o]["name"]);result.append(object)}return result}},hoverActive:function(){$(".motopress-leftbar-group .motopress-leftbar-group-active").mouseover(function(){$(this).addClass("active")})}})});steal("jquery/class",function($){$.Class("CE.ImageLibrary",{myThis:null},{frame:null,propertyImage:null,init:function(){CE.ImageLibrary.myThis=this;this.frame=parent.wp.media({id:"motopress-image-library",multiple:false,describe:false,toolbar:"select",sidebar:"settings",content:"upload",router:"browse",menu:"default",searchable:true,filterable:false,sortable:false,title:localStorage.getItem("CEImageLibraryText"),button:{text:localStorage.getItem("CEImageLibraryText")},library:{type:"image"},contentUserSetting:true,syncSelection:true});this.frame.on("open",this.proxy("onOpen"));this.frame.on("select",this.proxy("setImage"));this.frame.on("close",this.proxy("onClose"))},onOpen:function(){this.frame.reset();this.propertyImage=CE.Dialog.myThis.element.find('[data-motopress-open-img-lib="1"]');var imgCtrl=this.propertyImage.controller();if(imgCtrl.id!==null){var attachment=parent.wp.media.attachment(imgCtrl.id);attachment.fetch();this.frame.state().get("selection").add(attachment)}},setImage:function(){var attributes=this.frame.state().get("selection").models[0].attributes;var size="full";if(attributes.sizes.hasOwnProperty("medium")){size="medium"}else{if(attributes.sizes.hasOwnProperty("thumbnail")){size="thumbnail"}}var src=attributes.sizes[size].url;var imgCtrl=this.propertyImage.controller();imgCtrl.set({id:attributes.id,src:src});imgCtrl.showTools();imgCtrl.element.trigger("change");this.propertyImage.removeAttr("data-motopress-open-img-lib")},onClose:function(){$("."+CE.Dialog.myThis.dialogClass).focus();var HtmlBody=$(parent.document).find("html, body");HtmlBody.addClass("motopress-ce-jumping-fix");var tJumpFix=setTimeout(function(){HtmlBody.removeClass("motopress-ce-jumping-fix");clearTimeout(tJumpFix)},0)}})});steal("jquery/class",function($){$.Class("CE.WPGallery",{myThis:null},{frame:null,ctrl:null,init:function(){CE.WPGallery.myThis=this;var media=parent.wp.media,Attachment=media.model.Attachment;media.controller.CEGallery=media.controller.FeaturedImage.extend({defaults:parent._.defaults({id:"motopress-media-library-gallery",title:localStorage.getItem("CEWpGalleryText"),toolbar:"main-insert",filterable:"uploaded",library:media.query({type:"image"}),multiple:"add",editable:true,priority:60,syncSelection:false},media.controller.Library.prototype.defaults),updateSelection:function(){var selection=this.get("selection"),ids=CE.WPGallery.myThis.ctrl.get(),attachments;if(""!==ids&&-1!==ids){attachments=parent._.map(ids.split(/,/),function(id){return Attachment.get(id)})}selection.reset(attachments)}});media.view.MediaFrame.CEGallery=media.view.MediaFrame.Post.extend({createStates:function(){var options=this.options;this.states.add([new media.controller.CEGallery()])},bindHandlers:function(){media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments);this.on("toolbar:create:main-insert",this.createToolbar,this);var handlers={content:{embed:"embedContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar"}};parent._.each(handlers,function(regionHandlers,region){parent._.each(regionHandlers,function(callback,handler){this.on(region+":render:"+handler,this[callback],this)},this)},this)},mainInsertToolbar:function(view){var controller=this;this.selectionStatusToolbar(view);view.set("insert",{style:"primary",priority:80,text:localStorage.getItem("CEWpGalleryText"),requires:{selection:true},click:function(){var state=controller.state(),selection=state.get("selection");controller.close();state.trigger("insert",selection).reset()}})}});this.frame=new media.view.MediaFrame.CEGallery(parent._.defaults({},{state:"motopress-media-library-gallery",title:localStorage.getItem("CEWpGalleryText"),library:{type:"image"},multiple:true}));this.frame.on("open",this.proxy("onOpen"));this.frame.on("close",this.proxy("onClose"));this.frame.on("insert",this.proxy("setImage"))},open:function(ctrl){this.ctrl=ctrl;this.frame.open()},onOpen:function(){var frame=this.frame;frame.reset();var ids=this.ctrl.getArray();if(ids!==null){var attachment=null;ids.forEach(function(id){attachment=parent.wp.media.attachment(id);attachment.fetch();frame.state().get("selection").add(attachment)})}},onClose:function(){$("."+CE.Dialog.myThis.dialogClass).focus();var HtmlBody=$(parent.document).find("html, body");HtmlBody.addClass("motopress-ce-jumping-fix");var tJumpFix=setTimeout(function(){HtmlBody.removeClass("motopress-ce-jumping-fix");clearTimeout(tJumpFix)},0)},setImage:function(){var ids=[];var models=this.frame.state().get("selection").models;$.each(models,function(key,model){var attributes=model.attributes;ids.push(attributes.id)});this.ctrl.set(ids);this.ctrl.element.trigger("change")}})});steal("jquery/class",function($){$.Class("CE.Dialog",{myThis:null},{dialogClass:"motopress-dialog",element:$("<div />",{id:"motopress-dialog"}),currentSpan:null,dialog:null,setup:function(){this.element.appendTo("body")},init:function(){CE.Dialog.myThis=this;var dialog=null;var isHandleN=false;var scrollTop=0;var jqVersion=parent.MP.Utils.version_compare($.fn.jquery,"1.9.0","<");var left=sessionStorage.getItem("motopressDialogLeft");var top=sessionStorage.getItem("motopressDialogTop");var position=(left!==null&&top!==null)?[parseInt(left),parseInt(top)]:"right top";var width=sessionStorage.getItem("motopressDialogWidth");var height=sessionStorage.getItem("motopressDialogHeight");if(width===null){width=300}if(height===null){height="auto"}$.ui.dialog.prototype._focusTabbable=function(){};this.element.dialog({autoOpen:false,closeOnEscape:true,closeText:localStorage.getItem("close"),dialogClass:this.dialogClass,draggable:true,modal:false,position:position,resizable:true,minWidth:240,width:width,minHeight:240,height:height,maxHeight:$(window).height(),create:function(){CE.Dialog.myThis.dialog=$(".ui-dialog");dialog=CE.Dialog.myThis.dialog;dialog.on("resizestart",function(e,ui){isHandleN=$(e.originalEvent.target).hasClass("ui-resizable-n");scrollTop=$(document).scrollTop();if(jqVersion){if(!isHandleN){$(this).css("top",parseInt($(this).css("top"))-scrollTop)}}});dialog.on("resize",function(e,ui){if(jqVersion&&isHandleN){$(this).css("top",parseInt($(this).css("top"))-scrollTop)}});dialog.on("resizestop",function(e,ui){CE.Dialog.myThis.savePosition(ui);CE.Dialog.myThis.saveSize(ui)})},dragStop:function(e,ui){CE.Dialog.myThis.savePosition(ui)},close:function(){CE.Dialog.myThis.close()},open:function(){var selected=$("."+CE.Selectable.myThis.selectedClass);if(selected.length){CE.Selectable.focusWithoutScroll(selected.prev())}var dLeft=parseInt(sessionStorage.getItem("motopressDialogLeft"));var dTop=parseInt(sessionStorage.getItem("motopressDialogTop"));var dWidth=dialog.width(),dHeight=dialog.height();var wWidth=$(window).width(),wHeight=$(window).height();if(dHeight>wHeight){dHeight=wHeight;dialog.height(dHeight)}if(dTop<0){dialog.css("top",0)}else{if(dHeight<wHeight&&dTop+dHeight>wHeight){dialog.css("top",wHeight-dHeight)}else{if(dTop+dHeight>wHeight){dialog.css("top",wHeight-dHeight)}else{dialog.css("top",dTop)}}}if(dLeft<0){dialog.css("left",0)}else{if(dWidth<wWidth&&dLeft+dWidth>wWidth){dialog.css("left",wWidth-dWidth)}else{dialog.css("left",dLeft)}}}});$(parent.window).on("resize",this.proxy("onResize"))},onResize:function(){this.element.dialog("option","maxHeight",$(window).height())},open:function(dragHandle){var el=dragHandle.parent(".motopress-helper").prev(".motopress-block-content").children("[data-motopress-shortcode]");var group=el.attr("data-motopress-group");var objectId=el.attr("data-motopress-shortcode");if(CE.LeftBar.myThis.library!==null&&typeof group!=="undefined"&&typeof objectId!=="undefined"){if(CE.LeftBar.myThis.library[group].objects.hasOwnProperty(objectId)){var object=CE.LeftBar.myThis.library[group].objects[objectId];if(!$.isEmptyObject(object.parameters)){this.setTitle(object.name);this.currentSpan=dragHandle.closest('[class*="span"].motopress-span');var isNew=false;if(this.currentSpan.hasClass("motopress-new-object")){isNew=true;this.currentSpan.removeClass("motopress-new-object")}this.currentSpan.controller().displayData(isNew);this.element.dialog("open");this.element.find(".motopress-controls").trigger("dialogOpen")}}}},close:function(){this.setTitle();var selected=$("."+CE.Selectable.myThis.selectedClass);if(selected.length){CE.Selectable.focusWithoutScroll(selected.prev())}},setTitle:function(title){title=typeof title!=="undefined"?title:"";if(typeof title==="string"){this.element.dialog("option","title",localStorage.getItem("edit")+" "+title)}},savePosition:function(ui){sessionStorage.setItem("motopressDialogLeft",this.dialog.css("left"));sessionStorage.setItem("motopressDialogTop",this.dialog.css("top"))},saveSize:function(ui){sessionStorage.setItem("motopressDialogWidth",ui.size.width);sessionStorage.setItem("motopressDialogHeight",ui.size.height)}})});steal("jquery/controller").then("mp/ce/shortcode/shortcode.js"+parent.motopress.pluginVersionParam,"mp/ce/controls/templates.js"+parent.motopress.pluginVersionParam,"mp/ce/controls/ctrl.js"+parent.motopress.pluginVersionParam,function($){CE.Shortcode("CE.Controls",{},{forms:null,isNew:false,generalAttrs:null,init:function(el,args){this._super(el,args);this.forms=$("<div />");this.isNew=args.isNew;var groupName=this.shortcode.attr("data-motopress-group");var shortcodeName=this.shortcode.attr("data-motopress-shortcode");this.generalAttrs=$.extend(true,{},CE.LeftBar.myThis.library[groupName].objects[shortcodeName].parameters);this.generateForms()},render:function(flag){if(flag||typeof flag==="undefined"){CE.Resizer.myThis.updateBottomInHandleMiddle();CE.Resizer.myThis.updateHandle()}CE.Resizer.myThis.updateSplitterHeight(this.element,"render");this.shortcode.find("a").attr("tabindex",-1)},generateForms:function(){var shortcodeAttrs=this.getShortcodeAttrs();if(shortcodeAttrs){var $this=this;var form=null;var label=null;var description=null;$.each(this.generalAttrs,function(name,props){var id=parent.MP.Utils.uniqid();props.value=shortcodeAttrs[name].value;label=CE.CtrlTemplates.createLabel(props.label);description=CE.CtrlTemplates.createDescription(props.description);switch(props.type){case"text":form=CE.CtrlTemplates.createText(null,name);form.ce_ctrl_input({name:name});$this.forms.append(label,form,description);break;case"number":form=CE.CtrlTemplates.createNumber(props);form.ce_ctrl_input({name:name});$this.forms.append(label,form,description);break;case"longtext":form=CE.CtrlTemplates.createTextarea(props);form.ce_ctrl_textarea({name:name});$this.forms.append(label,form,description);break;case"image":props.src=props.value;form=CE.CtrlTemplates.createImage(props);form.ce_ctrl_image({name:name,isNew:$this.isNew});$this.forms.append(label,form,description);break;case"multi-images":form=CE.CtrlTemplates.createButton(props,null,"default");form.ce_ctrl_image_slider({name:name,isNew:$this.isNew});$this.forms.append(label,form,description);break;case"video":form=CE.CtrlTemplates.createVideo(null,name);form.ce_ctrl_video({name:name});$this.forms.append(label,form,description);break;case"checkbox":form=CE.CtrlTemplates.createCheckbox(props);form.ce_ctrl_checkbox({name:name});label.addClass("motopress-property-checkbox-label");$this.forms.append(form,label,description);break;case"select":form=CE.CtrlTemplates.createSelect(props);form.ce_ctrl_select({name:name});$this.forms.append(label,form,description);break;case"color-select":form=CE.CtrlTemplates.createColorSelect(props);form.ce_ctrl_select({name:name});$this.forms.append(label,form,description);break}form.addClass("motopress-controls");form.attr("id",id);label.attr("for",id)})}this.forms.find("hr:last").remove();this.forms=this.forms.children()},displayData:function(isNew){var dialog=CE.Dialog.myThis.element;dialog.find(".motopress-controls").detach().end().html(this.forms);var shortcodeAttrs=this.getShortcodeAttrs();if(shortcodeAttrs){var $this=this;var value=null;var defaultValue=null;var ctrl=null;dialog.find(".motopress-controls").each(function(){ctrl=$(this).controller();value=shortcodeAttrs[ctrl.name].value;defaultValue=$this.generalAttrs[ctrl.name]["default"];ctrl.set(value,defaultValue,isNew);$(this).trigger("customize")})}},saveData:function(ctrl){var shortcodeAttrs=this.getShortcodeAttrs();if(shortcodeAttrs){if(typeof ctrl!=="undefined"&&typeof ctrl.name!=="undefined"){shortcodeAttrs[ctrl.name].value=ctrl.get()}else{var dialog=CE.Dialog.myThis.element;var value=null;dialog.find(".motopress-controls").each(function(){ctrl=$(this).controller();value=ctrl.get();shortcodeAttrs[ctrl.name].value=value})}this.setShortcodeAttrs(shortcodeAttrs);this.renderShortcode()}},getShortcodeAttrs:function(){var shortcodeAttrs=this.shortcode.attr("data-motopress-parameters");return(shortcodeAttrs)?$.parseJSON(shortcodeAttrs):false},setShortcodeAttrs:function(shortcodeAttrs){this.shortcode.attr("data-motopress-parameters",JSON.stringify(shortcodeAttrs))}})});steal("mp/ce/shortcode/shortcode.js"+parent.motopress.pluginVersionParam,function($){CE.Shortcode("CE.InlineEditor",{curElement:null,init:function(){$(document).on("mousedown",".mce-tinymce.mce-panel",function(event){event.preventDefault()});$(document).on("keydown",'[data-motopress-shortcode="mp_text"],[data-motopress-shortcode="mp_heading"]',function(e){if(e.which===$.ui.keyCode.TAB){CE.Selectable.myThis.unselect()}else{if(e.which===$.ui.keyCode.ESCAPE){if(CE.InlineEditor.curElement){CE.InlineEditor.curElement.controller().close(true,"show")}var handle=$(this).closest('[class*="span"].motopress-span').find(".motopress-drag-handle");CE.Selectable.focusWithoutScroll(handle.prev())}}});$(parent.document).on("mousedown",function(){if(CE.InlineEditor.curElement){CE.InlineEditor.curElement.controller().close(true,"show")}})},isTinymce:function(e){var isTinymce=false;if(!$(e.target).hasClass("motopress-drag-handle")){var clickedEl=$(e.currentTarget.activeElement);if(clickedEl.length&&(clickedEl.closest("[data-motopress-shortcode]").length||clickedEl.closest(".mce-tinymce").length)){isTinymce=true}}return isTinymce}},{id:null,isOpen:false,editor:null,helpers:null,blockContent:null,floatpanel:null,saved:false,init:function(el,args){this._super(el,args);this.id=parent.MP.Utils.uniqid();this.helpers=el.find(".motopress-helper").children().not(".motopress-splitter");this.resizers=el.find(".ui-resizable-handle");this.blockContent=el.children(".motopress-block-content")},destroy:function(){CE.InlineEditor.curElement=null;if(this.floatpanel){this.floatpanel.remove()}this._super()},render:function(){var $this=this;var editorArea=this.shortcode.children();editorArea.attr("id",this.id);var handle=this.element.find(".motopress-drag-handle");var tinymceTimer=setTimeout(function(){tinyMCE.init({selector:"#"+$this.id,inline:true,plugins:"link code hr visualblocks textcolor",visual:false,convert_urls:false,menubar:false,toolbar:"undo redo | styleselect | bold italic | fontsizeselect forecolor | bullist numlist | indent outdent | link hr | visualblocks code",fontsize_formats:"8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt",setup:function(editor){$this.editor=editor;editor.on("loadContent",function(){$this.shortcode.find("a").attr("tabindex",-1);$this.autoOpen(handle,1)});editor.on("execCommand",function(e){switch(e.command){case"mceToggleEditor":if(!$this.floatpanel){var floatpanel=$("body").children(".mce-floatpanel:last");if(floatpanel.length){$this.floatpanel=floatpanel;if(floatpanel.height()>50){var fixedWidth=723;var fixedHeight=floatpanel.find('.mce-container-body.mce-flow-layout > [role="toolbar"]:first').outerHeight(true)-2;floatpanel.width(fixedWidth).height(fixedHeight);var panel2=floatpanel.children(".mce-container-body.mce-abs-layout").width(fixedWidth).height(fixedHeight);var panel3=panel2.children(".mce-container.mce-panel").width(fixedWidth).height(fixedHeight);panel3.children(".mce-container-body.mce-stack-layout").width(fixedWidth).height(fixedHeight)}}}var floatpanelPos=$this.floatpanel.offset().left+$this.floatpanel.width();if(floatpanelPos>$(window).width()){var left=$this.element.offset().left+$this.element.width()-$this.floatpanel.width();$this.floatpanel.css("left",left)}break}})},init_instance_callback:function(editor){var menu=editor.menuItems.formats.menu;$.each(menu,function(key1,val1){if(val1.text==="Blocks"){$.each(val1.menu,function(key2,val2){if(val2.text==="Div"){delete val1.menu[key2]}})}});$(editor.getBody()).on("blur",function(){$this.save()});$(editor.getBody()).on("focus",function(){$this.saved=false;if(handle.hasClass(CE.Selectable.myThis.selectedClass)){handle.trigger("click")}else{var t=setTimeout(function(){CE.LeftBar.myThis.leftBar.focus();clearTimeout(t)},0)}})}});clearTimeout(tinymceTimer)},0)},".motopress-drag-handle click":function(el){if(el.hasClass(CE.Selectable.myThis.selectedClass)&&!this.isOpen){this.isOpen=true;CE.InlineEditor.curElement=this.element;this.helpers.hide();$(".motopress-content-wrapper > .motopress-handle-middle-in:last").addClass("motopress-hide");this.resizers.hide();this.blockContent.addClass("motopress-overflow-visible-important");this.editor.execCommand("mceToggleEditor",false);this.showHideFloatpanel("show")}},close:function(resizerFlag,mode){if(this.isOpen){this.isOpen=false;this.save();this.helpers.show();$(".motopress-content-wrapper > .motopress-handle-middle-in:last").removeClass("motopress-hide");if(typeof resizerFlag!=="undefined"){if(mode==="show"){this.resizers.show()}else{if(mode==="hide"){this.resizers.hide()}}}this.showHideFloatpanel("hide");this.blockContent.removeClass("motopress-overflow-visible-important");CE.Resizer.myThis.updateHandle();parent.CE.Save.changeContent()}},save:function(){if(!this.saved){this.shortcode.find("a").removeAttr("tabindex");this.shortcode.attr("data-motopress-content",this.editor.getContent({format:"html"}));this.shortcode.find("a").attr("tabindex",-1);this.saved=true;CE.Resizer.myThis.updateBottomInHandleMiddle();CE.Resizer.myThis.updateSplitterHeight(this.element,"split")}},autoOpen:function(handle,count){if(count<=3){if(count>1&&handle.hasClass(CE.Selectable.myThis.selectedClass)){$(this.editor.getBody()).trigger("blur").trigger("focus");handle.trigger("click")}else{var $this=this;var tId=setTimeout(function(){$this.autoOpen(handle,count+1);clearTimeout(tId)},500)}}},showHideFloatpanel:function(mode){if(this.floatpanel){(mode==="show")?this.floatpanel.show():this.floatpanel.hide()}}})});steal("mp/ce/shortcode/shortcode.js"+parent.motopress.pluginVersionParam,function($){CE.Shortcode("CE.CodeEditor",{},{init:function(el,args){this._super(el,args);this.autoOpen(el.find(".motopress-drag-handle"),1)},destroy:function(){this._super()},render:function(){this.shortcode.find(".row").removeClass("row").addClass("mp-row-fluid");this.shortcode.find("a").attr("tabindex",-1);CE.Resizer.myThis.updateBottomInHandleMiddle();CE.Resizer.myThis.updateSplitterHeight();CE.Resizer.myThis.updateHandle()},autoOpen:function(handle,count){if(count<=3){if(count>1&&handle.hasClass(CE.Selectable.myThis.selectedClass)){handle.trigger("click")}else{var $this=this;var tId=setTimeout(function(){$this.autoOpen(handle,count+1);clearTimeout(tId)},500)}}},".motopress-drag-handle click":function(el){if(el.hasClass(CE.Selectable.myThis.selectedClass)){var editor=parent.CE.CodeModal.myThis.editor;parent.CE.CodeModal.currentSpan=this.element;var content=this.shortcode.attr("data-motopress-content");if(typeof content!=="undefined"){var expr=new RegExp("\\[\\]","ig");content=content.replace(expr,"[");if(editor!==null){editor.setContent(content,{format:"html"})}parent.CE.CodeModal.myThis.content.val(content)}parent.CE.CodeModal.myThis.element.modal("show")}}})});steal("jquery/class").then("mp/ce/resizer/resizer.js"+parent.motopress.pluginVersionParam,"mp/ce/tools/tools.js"+parent.motopress.pluginVersionParam,function($){$.Class("CE.DragDrop",{myThis:null,interruptInsert:false,curHandle:null},{blockContent:$("<div />",{"class":"motopress-block-content"}),handleTopIn:$("<div />",{"class":"motopress-handle-top-in","data-motopress-position":"top-in"}),handleBottomIn:$("<div />",{"class":"motopress-handle-bottom-in","data-motopress-position":"bottom-in"}),handleIntermediate:$("<div />",{"class":"motopress-handle-intermediate","data-motopress-position":"intermediate"}),handleLeftOut:$("<div />",{"class":"motopress-handle-left-out","data-motopress-position":"left-out"}),handleRightOut:$("<div />",{"class":"motopress-handle-right-out","data-motopress-position":"right-out"}),handleLeftIn:$("<div />",{"class":"motopress-handle-left-in","data-motopress-position":"left-in"}),handleRightIn:$("<div />",{"class":"motopress-handle-right-in","data-motopress-position":"right-in"}),handleLeft:$("<div />",{"class":"motopress-handle-left","data-motopress-position":"left"}),handleRight:$("<div />",{"class":"motopress-handle-right","data-motopress-position":"right"}),overlay:$("<div />",{"class":"motopress-overlay"}),dragHandle:$("<div />",{"class":"motopress-drag-handle",}),focusArea:$("<div />",{"class":"motopress-focus-area",tabindex:-1}),helper:$("<div />",{"class":"motopress-helper"}),handleMiddleOut:$("<span />",{"class":"motopress-handle-middle-out","data-motopress-position":"middle-out"}),handleMiddleIn:$("<span />",{"class":"motopress-handle-middle-in","data-motopress-position":"middle-in"}),emptySceneHelper:$("<div />",{id:"motopress-empty-scene-helper",html:'<div class="motopress-empty-scene-container-first"><div class="motopress-empty-scene-image"></div><div class="motopress-empty-scene-wrapper-right"><div class="motopress-empty-scene-title">'+localStorage.getItem("CEEmptySceneHelperTitle")+'</div><div class="motopress-empty-scene-content">'+localStorage.getItem("CEEmptySceneHelperContent")+'</div></div></div><div class="motopress-empty-scene-container-second"><div class="motopress-empty-scene-or">'+localStorage.getItem("CEEmptySceneHelperOr")+'</div><input type="text" class="motopress-empty-scene-type-here" value="'+localStorage.getItem("CEEmptySceneHelperInputText")+'"></div>'}),handleInsert:$("<div />",{"class":"motopress-handle-insert","data-motopress-position":"insert"}),emptySpanOverlay:$("<div />",{"class":"motopress-overlay"}),emptySpanHelper:$("<div />",{"class":"motopress-helper"}),handleWrapper:$("<div />",{"class":"motopress-handle-wrapper"}),wrapperHelperContainer:$("<div />",{"class":"motopress-wrapper-helper-container"}),handleWrapperLeft:$("<div />",{"class":"motopress-handle-wrapper-left","data-motopress-position":"wrapper-left"}),handleWrapperRight:$("<div />",{"class":"motopress-handle-wrapper-right","data-motopress-position":"wrapper-right"}),wrapperHelper:$("<div />",{"class":"motopress-wrapper-helper"}),wrapperHelperResizer:$("<div />",{"class":"motopress-helper"}),wrapperId:0,lineHelperIntermediate:$("<div />",{"class":"motopress-line-helper-intermediate"}),lineHelperLeftOut:$("<div />",{"class":"motopress-line-helper-left-out"}),lineHelperRightOut:$("<div />",{"class":"motopress-line-helper-right-out"}),lineHelperLeft:$("<div />",{"class":"motopress-line-helper-left"}),lineHelperRight:$("<div />",{"class":"motopress-line-helper-right"}),lineHelperLeftIn:$("<div />",{"class":"motopress-line-helper-left-in"}),lineHelperRightIn:$("<div />",{"class":"motopress-line-helper-right-in"}),lineHelperTopIn:$("<div />",{"class":"motopress-line-helper-top-in"}),lineHelperBottomIn:$("<div />",{"class":"motopress-line-helper-bottom-in"}),lineHelperHandleMiddle:$("<div />",{"class":"motopress-line-helper-middle-in"}),lineHelperInsert:$("<div />",{"class":"motopress-line-helper-insert"}),lineHelperWrapperLeft:$("<div />",{"class":"motopress-line-helper-wrapper-left"}),lineHelperWrapperRight:$("<div />",{"class":"motopress-line-helper-wrapper-right"}),textHelperIntermediate:$("<div />",{"class":"motopress-text-helper-intermediate",text:localStorage.getItem("helperNewColumn")}),textHelperLeftOut:$("<div />",{"class":"motopress-text-helper-left-out",text:localStorage.getItem("helperNewColumn")}),textHelperRightOut:$("<div />",{"class":"motopress-text-helper-right-out",text:localStorage.getItem("helperNewColumn")}),textHelperLeft:$("<div />",{"class":"motopress-text-helper-left",text:localStorage.getItem("helperNewColumn")}),textHelperRight:$("<div />",{"class":"motopress-text-helper-right",text:localStorage.getItem("helperNewColumn")}),textHelperLeftIn:$("<div />",{"class":"motopress-text-helper-left-in",text:localStorage.getItem("helperLeftIn")}),textHelperRightIn:$("<div />",{"class":"motopress-text-helper-right-in",text:localStorage.getItem("helperRightIn")}),textHelperTopIn:$("<div />",{"class":"motopress-text-helper-top-in",text:localStorage.getItem("helperTopIn")}),textHelperBottomIn:$("<div />",{"class":"motopress-text-helper-bottom-in",text:localStorage.getItem("helperBottomIn")}),textHelperHandleMiddle:$("<div />",{"class":"motopress-text-helper-middle-in",text:localStorage.getItem("helperMiddle")}),textHelperInsert:$("<div />",{"class":"motopress-text-helper-insert",text:localStorage.getItem("helperInsert")}),textHelperWrapperLeft:$("<div />",{"class":"motopress-text-helper-wrapper-left",text:localStorage.getItem("helperNewColumn")}),textHelperWrapperRight:$("<div />",{"class":"motopress-text-helper-wrapper-right",text:localStorage.getItem("helperNewColumn")}),textHelperHalfSize:null,lineHelperThickness:null,lineHelperHalfThickness:null,handleMiddleHalfThickness:null,helperContainer:$("<div />",{"class":"motopress-helper-container",}).appendTo("body"),newBlock:$("<div />",{"class":"mp-span1 motopress-span"}),spaceClass:"motopress-space",resizer:new CE.Resizer(),tools:new CE.Tools(),sidebarList:null,staticBlockList:null,loopBlockList:null,headerList:null,footerList:null,setup:function(){this.overlay.append(this.handleIntermediate.clone(),this.handleLeft.clone(),this.handleTopIn,this.handleBottomIn,this.handleLeftOut,this.handleRightOut,this.handleLeftIn,this.handleRightIn,this.handleRight.clone());this.helper.append(this.overlay,this.focusArea.clone(),this.dragHandle.clone(),this.resizer.splitter.clone());this.emptySpanOverlay.append(this.handleIntermediate.clone(),this.handleLeft.clone(),this.handleInsert.clone(),this.handleRight.clone());this.emptySpanHelper.append(this.emptySpanOverlay,this.resizer.splitter.clone());this.handleWrapperLeft.append(this.wrapperHelperContainer.clone());this.handleWrapperRight.append(this.wrapperHelperContainer.clone());this.wrapperHelper.append(this.handleIntermediate.clone(),this.handleLeft.clone(),this.handleRight.clone());this.wrapperHelperResizer.append(this.resizer.splitter.clone());var calcT=setTimeout(function(){CE.DragDrop.myThis.textHelperHalfSize=Math.round(CE.DragDrop.myThis.textHelperHandleMiddle.height()/2);CE.DragDrop.myThis.lineHelperThickness=CE.DragDrop.myThis.lineHelperLeftIn.outerWidth();CE.DragDrop.myThis.lineHelperHalfThickness=Math.round(CE.DragDrop.myThis.lineHelperHandleMiddle.height()/2);CE.DragDrop.myThis.handleMiddleHalfThickness=Math.round(6/2);clearTimeout(calcT)},0);$(".motopress-content-wrapper").append(this.emptySceneHelper);this.helperContainer.append(this.lineHelperIntermediate,this.lineHelperLeftOut,this.lineHelperRightOut,this.lineHelperLeft,this.lineHelperRight,this.lineHelperLeftIn,this.lineHelperRightIn,this.lineHelperTopIn,this.lineHelperBottomIn,this.lineHelperHandleMiddle,this.lineHelperInsert,this.textHelperIntermediate,this.textHelperLeftOut,this.textHelperRightOut,this.textHelperLeft,this.textHelperRight,this.textHelperLeftIn,this.textHelperRightIn,this.textHelperTopIn,this.textHelperBottomIn,this.textHelperHandleMiddle,this.textHelperInsert)},init:function(){CE.DragDrop.myThis=this;this.main()},main:function(){this.addEmptySceneHelper();this.recursiveAddHandleMiddle($(".motopress-content-wrapper"));this.makeEditable($('.motopress-content-wrapper [class*="span"].motopress-span:not(.motopress-empty)'));this.makeEditableEmptySpan($('.motopress-content-wrapper [class*="span"].motopress-span.motopress-empty'));this.resizer.updateBottomInHandleMiddle();this.resizer.updateSplitterHeight(null,"init");this.resizer.updateSplittableOptions(null,null,null,"init");this.resizer.updateHandle()},isEmptyScene:function(){return(!$(".motopress-content-wrapper .mp-row-fluid.motopress-row").length)?true:false},addEmptySceneHelper:function(){this.makeEmptySceneHelperDroppable();this.makeEmptySceneHelperFocusable();if(this.isEmptyScene()){this.emptySceneHelper.show()}},makeEmptySceneHelperFocusable:function(){$(".motopress-empty-scene-type-here").on("focusin",function(){CE.DragDrop.myThis.emptySceneHelper.hide().css("opacity",1);var rowTo=$(this).closest(".mp-row-fluid.motopress-row");var rowFrom=null;var block=CE.DragDrop.myThis.newBlock.clone();block.removeClass("mp-span1").addClass("mp-span12");var ui={};ui.helper=$("<div />",{"data-motopress-close-type":"enclosed","data-motopress-shortcode":"mp_text","data-motopress-group":"text"});CE.DragDrop.myThis.makeEditable(block,ui,true);rowTo=block.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row");$(".motopress-content-wrapper").append(rowTo);var t1=setTimeout(function(){CE.DragDrop.myThis.addHandleMiddle(rowTo,"mp-span12");clearTimeout(t1)},0);var t2=setTimeout(function(){CE.Selectable.myThis.select(block.find(".motopress-drag-handle"));CE.DragDrop.myThis.makeDroppable();CE.DragDrop.myThis.resizer.updateBottomInHandleMiddle();CE.DragDrop.myThis.resizer.updateResizableOptions(block,rowFrom,rowTo);CE.Resizer.myThis.updateSplitterHeight(block,"drop");CE.Resizer.myThis.updateSplittableOptions(block,rowFrom,rowTo);CE.DragDrop.myThis.resizer.updateHandle();clearTimeout(t2)},0);parent.CE.Save.changeContent()})},makeEditable:function(obj,ui,isNew){obj.each(function(){var $this=$(this);if(!$this.closest(".motopress-block-content").length){CE.DragDrop.myThis.addHelpers($this);CE.DragDrop.myThis.resizer.makeResizable($this);CE.DragDrop.myThis.resizer.makeSplittable($this);CE.DragDrop.myThis.makeDraggable($this);CE.DragDrop.myThis.makeDroppable();CE.DragDrop.myThis.tools.makeHoverBlock($this);if(typeof ui!=="undefined"&&ui!==null){CE.DragDrop.myThis.setAttrs(obj,ui)}var blockContent=$this.children(".motopress-block-content");if(blockContent.length){var shortcodeName=blockContent.children("[data-motopress-shortcode]").attr("data-motopress-shortcode");isNew=(typeof isNew==="undefined"||!isNew)?false:true;switch(shortcodeName){case"mp_text":case"mp_heading":$this.ce_inline_editor();break;case"mp_code":$this.ce_code_editor();break;case"mp_space":break;default:if(isNew){$this.addClass("motopress-new-object")}$this.ce_controls({isNew:isNew});break}var ctrl=$this.controller();(ctrl)?(isNew?ctrl.renderShortcode(isNew):ctrl.render(false)):false}}})},makeEditableEmptySpan:function(obj){if(obj.length){obj.each(function(){if(!$(this).children(".motopress-helper").length){$(this).append(CE.DragDrop.myThis.emptySpanHelper.clone())}});var t=setTimeout(function(){CE.DragDrop.myThis.makeDroppable();clearTimeout(t)},0);this.resizer.makeSplittable(obj)}},addHelpers:function(obj){obj.each(function(){if(!$(this).children(".motopress-block-content").length&&!$(this).children(".mp-row-fluid.motopress-row").length){$(this).find("script").remove().end().wrapInner(CE.DragDrop.myThis.blockContent.clone());if(!$(this).children(".motopress-block-content").children().length){$(this).children(".motopress-block-content").append("<div />")}}if(!$(this).children(".motopress-helper").length){if($(this).children(".mp-row-fluid.motopress-row").length){$(this).attr("data-motopress-wrapper-id",CE.DragDrop.myThis.wrapperId);$(this).prepend(CE.DragDrop.myThis.wrapperHelperResizer.clone());var mainWrapperHelper=null;if($(this).parent(".mp-row-fluid.motopress-row").parent(".motopress-content-wrapper").length){mainWrapperHelper=CE.DragDrop.myThis.wrapperHelper.clone();$(this).prepend(mainWrapperHelper)}else{mainWrapperHelper=$(this).closest('[class*="span"].motopress-span:has(".motopress-wrapper-helper")').children(".motopress-wrapper-helper")}CE.DragDrop.myThis.addHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.droppableHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.wrapperId++}else{$(this).append(CE.DragDrop.myThis.helper.clone())}}})},setAttrs:function(block,ui){var shortcode=block.find(".motopress-block-content > div");var source=ui.draggable?ui.draggable:ui.helper;shortcode.attr({"data-motopress-close-type":source.attr("data-motopress-close-type"),"data-motopress-shortcode":source.attr("data-motopress-shortcode"),"data-motopress-group":source.attr("data-motopress-group")});var parameters=source.attr("data-motopress-parameters");if(typeof parameters!=="undefined"){shortcode.attr("data-motopress-parameters",parameters)}},makeDraggable:function(obj){var dragHandle=obj.find(".motopress-drag-handle");obj.draggable({cursor:"move",distance:5,helper:"clone",handle:".motopress-drag-handle",opacity:"0",zIndex:1,appendTo:".motopress-content-wrapper:first",start:function(){CE.Selectable.myThis.unselect(dragHandle);$(".motopress-splitter").addClass("motopress-hide");$(this).css("opacity",0.3);$('.motopress-content-wrapper [class*="span"].motopress-span .motopress-drag-handle').addClass("motopress-start-drag")},stop:function(e,ui){$(".motopress-splitter").removeClass("motopress-hide");$(this).css("opacity","");$('.motopress-content-wrapper [class*="span"].motopress-span .motopress-drag-handle').removeClass("motopress-start-drag");CE.Selectable.myThis.select(dragHandle);CE.DragDrop.myThis.helperContainer.children().hide()},drag:function(){CE.DragDrop.myThis.onDrag()}}).removeClass("ui-draggable")},makeDraggableNewBlock:function(){$(".motopress-ce-object").draggable({cursor:"move",cursorAt:{top:-10,left:-10},helper:"clone",zIndex:10002,appendTo:".motopress-content-wrapper:first",start:function(e,ui){var selectedDragHandle=$('.motopress-content-wrapper [class*="span"] .motopress-drag-handle.'+CE.Selectable.myThis.selectedClass);if(selectedDragHandle.length){CE.Selectable.myThis.unselect(selectedDragHandle)}$(".motopress-empty-scene-type-here").addClass("motopress-empty-scene-type-here-nohover");ui.helper.children(".motopress-ce-object-inner").css("cssText","box-shadow: none !important");$(this).closest(".popover").prev('.motopress-leftbar-group[data-clickover-open="1"]').trigger("mousedown");$(".motopress-splitter").addClass("motopress-hide");$('.motopress-content-wrapper [class*="span"].motopress-span .motopress-drag-handle').addClass("motopress-start-drag");ui.helper.data("dropped",false)},stop:function(e,ui){$(".motopress-empty-scene-type-here").removeClass("motopress-empty-scene-type-here-nohover");$(".motopress-splitter").removeClass("motopress-hide");$('.motopress-content-wrapper [class*="span"].motopress-span .motopress-drag-handle').removeClass("motopress-start-drag");if(ui.helper.data("dropped")===false){var dropped=CE.DragDrop.myThis.dropOnStageHandler(e,ui);if(dropped){parent.CE.Save.changeContent()}}CE.DragDrop.myThis.helperContainer.children().hide()},drag:function(){CE.DragDrop.myThis.onDrag()}})},onDrag:function(){var handleEl=$(".motopress-droppable-hover");if(handleEl.length){var curHandle=handleEl.attr("data-motopress-position");if(curHandle!==null){var helpers=".motopress-line-helper-"+curHandle+", .motopress-text-helper-"+curHandle;var children=this.helperContainer.children();children.not(helpers).hide();children.filter(helpers).show()}}else{this.helperContainer.children().hide()}},dropOnStageHandler:function(e,ui){var isNewBlock=ui.helper.hasClass("motopress-ce-object");var lastMiddleIn=$(".motopress-content-wrapper").find(".motopress-handle-middle-in:last");if(isNewBlock&&lastMiddleIn&&lastMiddleIn.hasClass("motopress-handle-middle-in")){var rowFrom,rowTo,myUI=null;var _dragDrop=CE.DragDrop.myThis;var block=_dragDrop.newBlock.clone();if(ui.helper.attr("data-motopress-shortcode")===CE.LeftBar.myThis.library.other.objects.mp_space.id){block.addClass(_dragDrop.spaceClass)}_dragDrop.makeEditable(block,ui,true);var spanClassDraggable=parent.MP.Utils.getSpanClass(block.prop("class").split(" "));rowTo=block.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row");lastMiddleIn.after(rowTo);var droppableTimeout=setTimeout(function(){_dragDrop.addHandleMiddle(rowTo,"motopress-content-wrapper");_dragDrop.resize(rowFrom,block,"middle",null);var dragHandle=block.find(".motopress-drag-handle");CE.Selectable.myThis.select(dragHandle);_dragDrop.makeDroppable();CE.DragDrop.myThis.resizer.updateBottomInHandleMiddle();_dragDrop.resizer.updateResizableOptions(block,rowFrom,rowTo);CE.Resizer.myThis.updateSplitterHeight(block,"drop");CE.Resizer.myThis.updateSplittableOptions(block,rowFrom,rowTo);CE.DragDrop.myThis.resizer.updateHandle();clearTimeout(droppableTimeout)},0);return true}return false},makeEmptySceneHelperDroppable:function(){this.emptySceneHelper.droppable({accept:".motopress-ce-object",tolerance:"pointer",drop:function(e,ui){CE.DragDrop.myThis.emptySceneHelper.hide().css("opacity",1);var span=$(this).closest('[class*="span"].motopress-span');if(span.length==0){span=$(this)}var spanClass=parent.MP.Utils.getSpanClass(span.prop("class").split(" "));var spanClassDraggable=null;var rowFrom=null;var rowTo=$(this).closest(".mp-row-fluid.motopress-row");var myUI=null;var block=null;var isNewBlock=ui.draggable.hasClass("motopress-ce-object");if(!isNewBlock){myUI=ui;block=myUI.draggable;rowFrom=block.parent(".mp-row-fluid.motopress-row")}else{myUI=null;block=CE.DragDrop.myThis.newBlock.clone();if(ui.draggable.attr("data-motopress-shortcode")===CE.LeftBar.myThis.library.other.objects.mp_space.id){block.addClass(CE.DragDrop.myThis.spaceClass)}CE.DragDrop.myThis.makeEditable(block,ui,true);rowFrom=null}spanClassDraggable=parent.MP.Utils.getSpanClass(block.prop("class").split(" "));spanClassDraggable=CE.DragDrop.myThis.removeEmptyBlocks(block,spanClassDraggable);var flag=false;if(spanClass==null){spanClass="mp-span12";flag=true}rowTo=block.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row");$(".motopress-content-wrapper").append(rowTo);var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);if(flag){spanClass="motopress-content-wrapper"}CE.DragDrop.myThis.addHandleMiddle(rowTo,spanClass);CE.DragDrop.myThis.resize(rowFrom,block,"middle");clearTimeout(t)},0);var droppableTimeout=setTimeout(function(){var dragHandle=block.find(".motopress-drag-handle");CE.Selectable.myThis.select(dragHandle);CE.DragDrop.myThis.makeDroppable();CE.DragDrop.myThis.resizer.updateBottomInHandleMiddle();CE.DragDrop.myThis.resizer.updateResizableOptions(block,rowFrom,rowTo);CE.Resizer.myThis.updateSplitterHeight(block,"drop");CE.Resizer.myThis.updateSplittableOptions(block,rowFrom,rowTo);CE.DragDrop.myThis.resizer.updateHandle();clearTimeout(droppableTimeout)},0);parent.CE.Save.changeContent()},over:function(){$(this).css("opacity",0.5)},out:function(){$(this).css("opacity",1)}})},makeDroppable:function(){$(".motopress-content-wrapper").find(".motopress-handle-intermediate, .motopress-handle-left, .motopress-handle-top-in, .motopress-handle-bottom-in, .motopress-handle-left-out, .motopress-handle-right-out, .motopress-handle-left-in, .motopress-handle-right-in, .motopress-handle-middle-in, .motopress-handle-insert, .motopress-handle-right").droppable({accept:'[class*="span"].motopress-span, .motopress-ce-object',tolerance:"pointer",hoverClass:"motopress-droppable-hover",drop:function(e,ui){var handle=$(this).attr("data-motopress-position");CE.DragDrop.myThis.hideLineTextHelper(handle);ui.helper.data("dropped",true);var span=$(this).closest('[class*="span"].motopress-span');if(span.length===0){span=$(this)}var spanClass=parent.MP.Utils.getSpanClass(span.prop("class").split(" "));var spanClassDraggable=null;var rowFrom=null;var rowTo=$(this).closest(".mp-row-fluid.motopress-row");var myUI=null;var block=null;var isNewBlock=ui.draggable.hasClass("motopress-ce-object");if(!isNewBlock){myUI=ui;block=myUI.draggable;rowFrom=block.parent(".mp-row-fluid.motopress-row")}else{myUI=null;block=CE.DragDrop.myThis.newBlock.clone();if(ui.draggable.attr("data-motopress-shortcode")===CE.LeftBar.myThis.library.other.objects.mp_space.id){block.addClass(CE.DragDrop.myThis.spaceClass)}CE.DragDrop.myThis.makeEditable(block,ui,true);rowFrom=null}spanClassDraggable=parent.MP.Utils.getSpanClass(block.prop("class").split(" "));spanClassDraggable=CE.DragDrop.myThis.removeEmptyBlocks(block,spanClassDraggable);switch(handle){case"top-in":var draggableSpan=block.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row");var row=span.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row").wrap('<div class="'+spanClass+' motopress-span" />');row.before(draggableSpan);var wrapperSpan=row.parent('[class*="span"].motopress-span');wrapperSpan.attr({"data-motopress-id":parent.MP.Utils.uniqid(),"data-motopress-wrapper-id":CE.DragDrop.myThis.wrapperId}).prepend(CE.DragDrop.myThis.wrapperHelperResizer.clone());CE.DragDrop.myThis.resizer.makeSplittable(wrapperSpan);var mainWrapperHelper=null;if(wrapperSpan.parent(".mp-row-fluid.motopress-row").parent(".motopress-content-wrapper").length){mainWrapperHelper=CE.DragDrop.myThis.wrapperHelper.clone();wrapperSpan.prepend(mainWrapperHelper)}else{mainWrapperHelper=wrapperSpan.closest('[class*="span"].motopress-span:has(".motopress-wrapper-helper")').children(".motopress-wrapper-helper")}CE.DragDrop.myThis.addHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.droppableHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.wrapperId++;var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);CE.DragDrop.myThis.addHandleMiddle(row,spanClass);CE.DragDrop.myThis.resize(rowFrom,block,"top-in");clearTimeout(t)},0);break;case"bottom-in":var draggableSpan=block.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row");var row=span.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row").wrap('<div class="'+spanClass+' motopress-span" />');row.after(draggableSpan);var wrapperSpan=row.parent('[class*="span"].motopress-span');wrapperSpan.attr({"data-motopress-id":parent.MP.Utils.uniqid(),"data-motopress-wrapper-id":CE.DragDrop.myThis.wrapperId}).prepend(CE.DragDrop.myThis.wrapperHelperResizer.clone());CE.DragDrop.myThis.resizer.makeSplittable(wrapperSpan);var mainWrapperHelper=null;if(wrapperSpan.parent(".mp-row-fluid.motopress-row").parent(".motopress-content-wrapper").length){mainWrapperHelper=CE.DragDrop.myThis.wrapperHelper.clone();wrapperSpan.prepend(mainWrapperHelper)}else{mainWrapperHelper=wrapperSpan.closest('[class*="span"].motopress-span:has(".motopress-wrapper-helper")').children(".motopress-wrapper-helper")}CE.DragDrop.myThis.addHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.droppableHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.wrapperId++;var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);CE.DragDrop.myThis.addHandleMiddle(row,spanClass);CE.DragDrop.myThis.resize(rowFrom,block,"bottom-in");clearTimeout(t)},0);break;case"left-out":case"left":case"intermediate":if(CE.DragDrop.myThis.canInsert(rowTo,myUI)){if(span.parent().length){span.before(block)}var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);if(rowFrom===null||rowFrom[0]!==rowTo[0]){CE.DragDrop.myThis.resize(rowFrom,block,"left-out")}else{var containsSpanNumber=parent.MP.Utils.calcSpanNumber(rowFrom,myUI);block.removeClass(spanClassDraggable).addClass("mp-span"+(12-containsSpanNumber))}clearTimeout(t)},0)}break;case"right-out":case"right":if(CE.DragDrop.myThis.canInsert(rowTo,myUI)){if(span.parent().length){span.after(block)}var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);if(rowFrom===null||rowFrom[0]!==rowTo[0]){CE.DragDrop.myThis.resize(rowFrom,block,"right-out")}else{var containsSpanNumber=parent.MP.Utils.calcSpanNumber(rowFrom,myUI);block.removeClass(spanClassDraggable).addClass("mp-span"+(12-containsSpanNumber))}clearTimeout(t)},0)}break;case"left-in":if(CE.DragDrop.myThis.canInsert(rowTo,myUI)&&parent.MP.Utils.getSpanNumber(spanClass)>1){var row=span.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row").wrap('<div class="'+spanClass+' motopress-span" />');span.before(block);var wrapperSpan=row.parent('[class*="span"].motopress-span');wrapperSpan.attr({"data-motopress-id":parent.MP.Utils.uniqid(),"data-motopress-wrapper-id":CE.DragDrop.myThis.wrapperId}).prepend(CE.DragDrop.myThis.wrapperHelperResizer.clone());CE.DragDrop.myThis.resizer.makeSplittable(wrapperSpan);var mainWrapperHelper=null;if(wrapperSpan.parent(".mp-row-fluid.motopress-row").parent(".motopress-content-wrapper").length){mainWrapperHelper=CE.DragDrop.myThis.wrapperHelper.clone();wrapperSpan.prepend(mainWrapperHelper)}else{mainWrapperHelper=wrapperSpan.closest('[class*="span"].motopress-span:has(".motopress-wrapper-helper")').children(".motopress-wrapper-helper")}CE.DragDrop.myThis.addHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.droppableHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.wrapperId++;var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);CE.DragDrop.myThis.addHandleMiddle(row,spanClass);CE.DragDrop.myThis.resize(rowFrom,block,"left-in");clearTimeout(t)},0)}break;case"right-in":if(CE.DragDrop.myThis.canInsert(rowTo,myUI)&&parent.MP.Utils.getSpanNumber(spanClass)>1){var row=span.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row").wrap('<div class="'+spanClass+' motopress-span" />');span.after(block);var wrapperSpan=row.parent('[class*="span"].motopress-span');wrapperSpan.attr({"data-motopress-id":parent.MP.Utils.uniqid(),"data-motopress-wrapper-id":CE.DragDrop.myThis.wrapperId}).prepend(CE.DragDrop.myThis.wrapperHelperResizer.clone());CE.DragDrop.myThis.resizer.makeSplittable(wrapperSpan);var mainWrapperHelper=null;if(wrapperSpan.parent(".mp-row-fluid.motopress-row").parent(".motopress-content-wrapper").length){mainWrapperHelper=CE.DragDrop.myThis.wrapperHelper.clone();wrapperSpan.prepend(mainWrapperHelper)}else{mainWrapperHelper=wrapperSpan.closest('[class*="span"].motopress-span:has(".motopress-wrapper-helper")').children(".motopress-wrapper-helper")}CE.DragDrop.myThis.addHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.droppableHandleWrapper(mainWrapperHelper);CE.DragDrop.myThis.wrapperId++;var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);CE.DragDrop.myThis.addHandleMiddle(row,spanClass);CE.DragDrop.myThis.resize(rowFrom,block,"right-in");clearTimeout(t)},0)}break;case"middle-in":var flag=false;if(spanClass==null){spanClass="mp-span12 motopress-span";flag=true}var minHeight=parseInt($(this).css("min-height"));$(this).siblings(".motopress-handle-middle-in").add(this).each(function(){$(this).height(minHeight)});rowTo=block.wrap('<div class="mp-row-fluid motopress-row" />').closest(".mp-row-fluid.motopress-row");$(this).after(rowTo);var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);if(flag){spanClass="motopress-content-wrapper"}CE.DragDrop.myThis.addHandleMiddle(rowTo,spanClass);CE.DragDrop.myThis.resize(rowFrom,block,"middle");clearTimeout(t)},0);break;case"insert":if(span.parent().length){span.replaceWith(block)}var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);CE.DragDrop.myThis.resize(rowFrom,block,"insert");clearTimeout(t)},0);break}var droppableTimeout=setTimeout(function(){var dragHandle=block.find(".motopress-drag-handle");CE.Selectable.myThis.select(dragHandle);CE.DragDrop.myThis.makeDroppable();CE.DragDrop.myThis.resizer.updateBottomInHandleMiddle();CE.DragDrop.myThis.resizer.updateResizableOptions(block,rowFrom,rowTo);CE.Resizer.myThis.updateSplitterHeight(block,"drop");CE.Resizer.myThis.updateSplittableOptions(block,rowFrom,rowTo);CE.DragDrop.myThis.resizer.updateHandle();clearTimeout(droppableTimeout)},0);parent.CE.Save.changeContent()},over:function(){var handle=$(this).attr("data-motopress-position");var span=(handle!=="middle-in")?$(this).closest('[class*="span"].motopress-span'):$(this);CE.DragDrop.myThis.showLineTextHelper(span,handle)},out:function(){var handle=$(this).attr("data-motopress-position");CE.DragDrop.myThis.hideLineTextHelper(handle)}})},showLineTextHelper:function(span,handle){var spanOffset=span.offset();var linePiece,lineWidth,lineLeft,width;if($.inArray(handle,["intermediate","left-out","right-out","left","right"])>=0){width=Math.floor(span.children(".motopress-helper, .motopress-wrapper-helper").find(".motopress-handle-intermediate").width());if(width>4){linePiece=2;lineWidth=width-4;lineLeft=width-linePiece}else{linePiece=1;lineWidth=lineLeft=width}}switch(handle){case"intermediate":this.lineHelperIntermediate.css({width:lineWidth,height:span.parent().height(),top:spanOffset.top,left:Math.ceil(spanOffset.left-lineLeft)}).show();this.textHelperIntermediate.css({top:this.lineHelperIntermediate.offset().top,left:this.lineHelperIntermediate.offset().left+lineWidth}).show();break;case"left-out":this.lineHelperLeftOut.css({width:lineWidth,height:span.parent().height(),top:spanOffset.top,left:Math.ceil(spanOffset.left-lineLeft)}).show();this.textHelperLeftOut.css({top:this.lineHelperLeftOut.offset().top,left:this.lineHelperLeftOut.offset().left+lineWidth}).show();break;case"right-out":var nextSpan=span.next();this.lineHelperRightOut.css({width:lineWidth,height:span.parent().height(),top:spanOffset.top,left:Math.ceil((nextSpan.length?nextSpan.offset().left-lineLeft:spanOffset.left+span.width()+linePiece))}).show();this.textHelperRightOut.css({top:this.lineHelperRightOut.offset().top,left:this.lineHelperRightOut.offset().left+lineWidth}).show();break;case"left":this.lineHelperLeft.css({width:lineWidth,height:span.parent().height(),top:spanOffset.top,left:Math.ceil(spanOffset.left-lineLeft)}).show();this.textHelperLeft.css({top:this.lineHelperLeft.offset().top,left:this.lineHelperLeft.offset().left+lineWidth}).show();break;case"right":var nextSpan=span.next();this.lineHelperRight.css({width:lineWidth,height:span.parent().height(),top:spanOffset.top,left:Math.ceil((nextSpan.length?nextSpan.offset().left-lineLeft:spanOffset.left+span.width()+linePiece))}).show();this.textHelperRight.css({top:this.lineHelperRight.offset().top,left:this.lineHelperRight.offset().left+lineWidth}).show();break;case"left-in":this.lineHelperLeftIn.css({height:span.height(),top:spanOffset.top,left:spanOffset.left}).show();this.textHelperLeftIn.css({top:this.lineHelperLeftIn.offset().top,left:this.lineHelperLeftIn.offset().left+this.lineHelperThickness}).show();break;case"right-in":this.lineHelperRightIn.css({height:span.height(),top:spanOffset.top,left:spanOffset.left+span.width()-this.lineHelperThickness}).show();this.textHelperRightIn.css({top:this.lineHelperRightIn.offset().top,left:this.lineHelperRightIn.offset().left-this.textHelperRightIn.outerWidth()}).show();break;case"top-in":this.lineHelperTopIn.css({width:span.width(),top:spanOffset.top,left:spanOffset.left}).show();this.textHelperTopIn.css({top:spanOffset.top,left:spanOffset.left}).show();break;case"bottom-in":this.lineHelperBottomIn.css({width:span.width(),top:spanOffset.top+span.height()-this.lineHelperThickness,left:spanOffset.left}).show();this.textHelperBottomIn.css({top:this.lineHelperBottomIn.offset().top,left:this.lineHelperBottomIn.offset().left}).show();break;case"middle-in":var width=span.width();var height=span.height()-(parseInt(this.lineHelperHandleMiddle.css("outline-width"))*2);var spanOffset=span.offset();var top=spanOffset.top+parseInt(this.lineHelperHandleMiddle.css("outline-width"));var left=spanOffset.left;var handleMiddleFirst=$(".motopress-content-wrapper > .motopress-handle-middle-in:first");if(span[0]===handleMiddleFirst[0]||span[0]===$(".motopress-content-wrapper > .motopress-handle-middle-in:last")[0]){var contentWrapper=$(".motopress-content-wrapper");var contentWrapperOffset=contentWrapper.offset();width=contentWrapper.width();height=20;if(span[0]===handleMiddleFirst[0]){top=contentWrapperOffset.top-height}left=contentWrapperOffset.left}this.lineHelperHandleMiddle.css({width:width,height:height,top:top,left:left}).show();var lineHelperOffset=this.lineHelperHandleMiddle.offset();this.textHelperHandleMiddle.css({top:lineHelperOffset.top,left:lineHelperOffset.left}).show();break;case"insert":this.lineHelperInsert.css({width:span.width(),height:span.height(),left:spanOffset.left,top:spanOffset.top}).show();this.textHelperInsert.css({top:this.lineHelperInsert.offset().top,left:this.lineHelperInsert.offset().left-this.textHelperInsert.outerWidth()}).show();break;case"wrapper-left":this.lineHelperWrapperLeft.css({height:span.height(),top:spanOffset.top,left:spanOffset.left-this.lineHelperThickness}).show();this.textHelperWrapperLeft.css({top:this.lineHelperWrapperLeft.offset().top,left:this.lineHelperWrapperLeft.offset().left-this.textHelperWrapperLeft.outerWidth()}).show();break;case"wrapper-right":this.lineHelperWrapperRight.css({height:span.height(),top:spanOffset.top,left:spanOffset.left+span.width()}).show();this.textHelperWrapperRight.css({top:this.lineHelperWrapperRight.offset().top,left:this.lineHelperWrapperRight.offset().left+this.lineHelperThickness}).show();break}},hideLineTextHelper:function(handle){return false;switch(handle){case"intermediate":this.lineHelperIntermediate.hide();this.textHelperIntermediate.hide();break;case"left-out":this.lineHelperLeftOut.hide();this.textHelperLeftOut.hide();break;case"right-out":this.lineHelperRightOut.hide();this.textHelperRightOut.hide();break;case"left":this.lineHelperLeft.hide();this.textHelperLeft.hide();break;case"right":this.lineHelperRight.hide();this.textHelperRight.hide();break;case"left-in":this.lineHelperLeftIn.hide();this.textHelperLeftIn.hide();break;case"right-in":this.lineHelperRightIn.hide();this.textHelperRightIn.hide();break;case"top-in":this.lineHelperTopIn.hide();this.textHelperTopIn.hide();break;case"bottom-in":this.lineHelperBottomIn.hide();this.textHelperBottomIn.hide();break;case"middle-in":this.lineHelperHandleMiddle.hide();this.textHelperHandleMiddle.hide();break;case"insert":this.lineHelperInsert.hide();this.textHelperInsert.hide();break;case"wrapper-left":this.lineHelperWrapperLeft.hide();this.textHelperWrapperLeft.hide();break;case"wrapper-right":this.lineHelperWrapperRight.hide();this.textHelperWrapperRight.hide();break}},removeEmptyBlocks:function(block,spanClassDraggable){var prevEmpty=block.prev(".motopress-empty");var nextEmpty=block.next(".motopress-empty");var prevEmptySpanNumber=0;var nextEmptySpanNumber=0;if(typeof prevEmpty[0]!="undefined"){prevEmptySpanNumber=parent.MP.Utils.getSpanNumber(parent.MP.Utils.getSpanClass(prevEmpty.prop("class").split(" ")))}if(typeof nextEmpty[0]!="undefined"){nextEmptySpanNumber=parent.MP.Utils.getSpanNumber(parent.MP.Utils.getSpanClass(nextEmpty.prop("class").split(" ")))}if(typeof prevEmpty[0]!="undefined"||typeof nextEmpty[0]!="undefined"){block.removeClass(spanClassDraggable);spanClassDraggable="mp-span"+(parent.MP.Utils.getSpanNumber(spanClassDraggable)+prevEmptySpanNumber+nextEmptySpanNumber);block.addClass(spanClassDraggable);prevEmpty.remove();nextEmpty.remove()}return spanClassDraggable},clearIfEmpty:function(rowFrom,action){if(typeof action==="undefined"){action="default"}if(rowFrom!==null){var parentSpan=rowFrom.parent();var rowFromChildren=rowFrom.children('[class*="span"].motopress-span');if(!rowFromChildren.length){var i=0;while(rowFrom.parent(".motopress-content-wrapper").length===0){if(!rowFrom.siblings('.mp-row-fluid.motopress-row, [class*="span"].motopress-span').length&&!rowFrom.parent(".motopress-content-wrapper").length){if(rowFrom.parent('[class*="span"].motopress-span').length){var wrapperId=rowFrom.parent('[class*="span"].motopress-span').attr("data-motopress-wrapper-id");$('[data-motopress-wrapper-id="'+wrapperId+'"].motopress-handle-wrapper').remove()}rowFrom.siblings(".motopress-handle-middle-in, .motopress-wrapper-helper, .motopress-helper").remove().end().unwrap()}else{break}i++;if(i===100){console.log("LOOPED IN `clearIfEmpty()`");break}}var flag=false;var newRowFrom=null;if(!rowFrom.siblings(".mp-row-fluid.motopress-row").length){flag=true;if(rowFrom.parent(":not(.motopress-content-wrapper)").length){newRowFrom=rowFrom.parent()}else{if(rowFrom.parent(".mp-row-fluid.motopress-row").length){newRowFrom=rowFrom.parent(".mp-row-fluid.motopress-row")}}}rowFrom.prev(".motopress-handle-middle-in").remove().end().remove();if(typeof parentSpan!=="undefined"&&parentSpan!==null&&!parentSpan.hasClass("motopress-content-wrapper")){var parentSpanInnerRow=parentSpan.children(".mp-row-fluid");if(parentSpanInnerRow.length===1){var parentSpanInnerSpan=parentSpanInnerRow.children('[class*="span"]:not(.motopress-empty)');if(parentSpanInnerSpan.length===1){var sClass1=parent.MP.Utils.getSpanClass(parentSpanInnerSpan.prop("class").split(" "));var sClass2=parent.MP.Utils.getSpanClass(parentSpan.prop("class").split(" "));parentSpanInnerSpan.removeClass(sClass1).addClass(sClass2);parentSpan.replaceWith(parentSpanInnerSpan)}}}return flag?newRowFrom:rowFrom}else{if(rowFromChildren.length===1&&!rowFrom.parent(".motopress-content-wrapper").length){var children,siblings,parentWrapper,replacementSpan=null;rowFromChildren.parentsUntil(".motopress-content-wrapper",'[class*="span"]').each(function(){children=$(this).children(".mp-row-fluid");siblings=$(this).siblings('[class*="span"]');parentWrapper=$(this).parent(".mp-row-fluid").parent(".motopress-content-wrapper");if(children.length===1&&(siblings.length||parentWrapper.length)){replacementSpan=$(this);return false}});if(replacementSpan!==null){var rowFromChildrenClass=parent.MP.Utils.getSpanClass(rowFromChildren.prop("class").split(" "));var replacementSpanClass=parent.MP.Utils.getSpanClass(replacementSpan.prop("class").split(" "));rowFromChildren.removeClass(rowFromChildrenClass).addClass(replacementSpanClass);replacementSpan.replaceWith(rowFromChildren);rowFrom=(action==="remove")?{row:replacementSpan.parent()}:null}}}}return rowFrom},recursiveAddHandleMiddle:function(span){span.children(".mp-row-fluid.motopress-row").each(function(index){var handleMiddle=null;handleMiddle=CE.DragDrop.myThis.handleMiddleIn;if(index==0){$(this).before(handleMiddle.clone())}$(this).after(handleMiddle.clone());if($(this).children('[class*="span"].motopress-span').children(".mp-row-fluid.motopress-row").length){$(this).children('[class*="span"].motopress-span').each(function(){CE.DragDrop.myThis.recursiveAddHandleMiddle($(this))})}})},addHandleMiddle:function(row,spanClass){row.parent("."+spanClass+".motopress-span, .motopress-content-wrapper").children(".mp-row-fluid.motopress-row").each(function(index){var handleMiddle=null;handleMiddle=CE.DragDrop.myThis.handleMiddleIn;if(index==0){var prev=$(this).prevAll(".motopress-handle-middle-in");if(prev.length==0){$(this).before(handleMiddle.clone())}else{prev.each(function(i,el){if(i!=0){$(el).remove()}})}}var next=$(this).nextUntil(".mp-row-fluid.motopress-row",".motopress-handle-middle-in");if(next.length==0){$(this).after(handleMiddle.clone())}else{next.each(function(i,el){if(i!=0){$(el).remove()}})}})},addHandleWrapper:function(mainWrapperHelper){mainWrapperHelper.find(".motopress-handle-wrapper-left > .motopress-wrapper-helper-container").append(this.handleWrapper.clone().attr({"data-motopress-wrapper-id":this.wrapperId,"data-motopress-position":"wrapper-left"}));mainWrapperHelper.find(".motopress-handle-wrapper-right > .motopress-wrapper-helper-container").append(this.handleWrapper.clone().attr({"data-motopress-wrapper-id":this.wrapperId,"data-motopress-position":"wrapper-right"}))},droppableHandleWrapper:function(wrapperHelper){wrapperHelper.find(".motopress-handle-wrapper").droppable({accept:'[class*="span"].motopress-span, .motopress-ce-object',tolerance:"pointer",drop:function(e,ui){var handle=$(this).attr("data-motopress-position");CE.DragDrop.myThis.hideLineTextHelper(handle);ui.helper.data("dropped",true);var wrapperId=$(this).attr("data-motopress-wrapper-id");var span=$('[data-motopress-wrapper-id="'+wrapperId+'"][class*="span"].motopress-span');var spanClassDraggable=null;var rowFrom=null;var rowTo=span.parent(".mp-row-fluid.motopress-row");var myUI=null;var block=null;var isNewBlock=ui.draggable.hasClass("motopress-ce-object");if(!isNewBlock){myUI=ui;block=myUI.draggable;rowFrom=block.parent(".mp-row-fluid.motopress-row")}else{myUI=null;block=CE.DragDrop.myThis.newBlock.clone();if(ui.draggable.attr("data-motopress-shortcode")===CE.LeftBar.myThis.library.other.objects.mp_space.id){block.addClass(CE.DragDrop.myThis.spaceClass)}CE.DragDrop.myThis.makeEditable(block,ui,true);rowFrom=null}spanClassDraggable=parent.MP.Utils.getSpanClass(block.prop("class").split(" "));spanClassDraggable=CE.DragDrop.myThis.removeEmptyBlocks(block,spanClassDraggable);switch(handle){case"wrapper-left":if(CE.DragDrop.myThis.canInsert(rowTo,myUI)){span.before(block);var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);if(rowFrom===null||rowFrom[0]!==rowTo[0]){CE.DragDrop.myThis.resize(rowFrom,block,"wrapper-left")}else{var containsSpanNumber=parent.MP.Utils.calcSpanNumber(rowFrom,myUI);block.removeClass(spanClassDraggable).addClass("mp-span"+(12-containsSpanNumber))}clearTimeout(t)},0)}break;case"wrapper-right":if(CE.DragDrop.myThis.canInsert(rowTo,myUI)){span.after(block);var t=setTimeout(function(){rowFrom=CE.DragDrop.myThis.clearIfEmpty(rowFrom);if(rowFrom===null||rowFrom[0]!==rowTo[0]){CE.DragDrop.myThis.resize(rowFrom,block,"wrapper-right")}else{var containsSpanNumber=parent.MP.Utils.calcSpanNumber(rowFrom,myUI);block.removeClass(spanClassDraggable).addClass("mp-span"+(12-containsSpanNumber))}clearTimeout(t)},0)}break}var droppableTimeout=setTimeout(function(){var dragHandle=block.find(".motopress-drag-handle");CE.Selectable.myThis.select(dragHandle);CE.DragDrop.myThis.makeDroppable();CE.DragDrop.myThis.resizer.updateBottomInHandleMiddle();CE.DragDrop.myThis.resizer.updateResizableOptions(block,rowFrom,rowTo);CE.Resizer.myThis.updateSplitterHeight(block,"drop");CE.Resizer.myThis.updateSplittableOptions(block,rowFrom,rowTo);CE.DragDrop.myThis.resizer.updateHandle();clearTimeout(droppableTimeout)},0);parent.CE.Save.changeContent()},over:function(){var span=$(this).closest('[class*="span"].motopress-span');CE.DragDrop.myThis.showLineTextHelper(span,$(this).attr("data-motopress-position"))},out:function(){CE.DragDrop.myThis.hideLineTextHelper($(this).attr("data-motopress-position"))}})},canInsert:function(rowTo,ui){var spanLimit=12;var spanCount=0;rowTo.children('[class*="span"].motopress-span').each(function(){if(parent.MP.Utils.notClone($(this),ui)&&!$(this).hasClass("motopress-empty")){spanCount++}});if(spanCount>=spanLimit){CE.DragDrop.interruptInsert=true;parent.MP.Flash.setFlash(localStorage.getItem("blocksOverflow"),"error");parent.MP.Flash.showMessage();return false}return true},resize:function(rowFrom,block,type){var sClass=null,sizes=null;if(rowFrom!==null&&typeof rowFrom!=="undefined"){var rowFromSpans=rowFrom.children('[class*="span"]');var rowFromSpanNumber=rowFromSpans.length;if(rowFromSpanNumber>0&&rowFromSpanNumber<=12){sizes=this.getSpanSizeRules(rowFromSpanNumber);rowFromSpans.each(function(i){sClass=parent.MP.Utils.getSpanClass($(this).prop("class").split(" "));$(this).removeClass(sClass).addClass("mp-span"+sizes[i])})}}var rowTo=block.parent();if(rowTo!==null&&typeof rowTo!=="undefined"){var rowToSpans=rowTo.children('[class*="span"]');var rowToSpanNumber=rowToSpans.length;if(rowToSpanNumber>0&&rowToSpanNumber<=12){sizes=this.getSpanSizeRules(rowToSpanNumber);rowToSpans.each(function(i){sClass=parent.MP.Utils.getSpanClass($(this).prop("class").split(" "));$(this).removeClass(sClass).addClass("mp-span"+sizes[i])})}}if(typeof type!=="undefined"){if(type==="top-in"||type==="bottom-in"){sClass=parent.MP.Utils.getSpanClass(block.prop("class").split(" "));block.removeClass(sClass).addClass("mp-span12");var rowIndex=(type==="top-in")?1:0;var realRowFrom=block.parent(".mp-row-fluid").parent('[class*="span"]').children(".mp-row-fluid").get(rowIndex);realRowFrom=$(realRowFrom);var siblingFrom=realRowFrom.children('[class*="span"]');if(typeof siblingFrom!=="undefined"&&siblingFrom.length){sClass=parent.MP.Utils.getSpanClass(siblingFrom.prop("class").split(" "));siblingFrom.removeClass(sClass).addClass("mp-span12")}}}},getSpanSizeRules:function(spanNumber){var res=null;switch(spanNumber){case 1:res=[12];break;case 2:res=[6,6];break;case 3:res=[4,4,4];break;case 4:res=[3,3,3,3];break;case 5:res=[3,3,2,2,2];break;case 6:res=[2,2,2,2,2,2];break;case 7:res=[2,2,2,2,2,1,1];break;case 8:res=[2,2,2,2,1,1,1,1];break;case 9:res=[2,2,2,1,1,1,1,1,1];break;case 10:res=[2,2,1,1,1,1,1,1,1,1];break;case 11:res=[2,1,1,1,1,1,1,1,1,1,1];break;case 12:res=[1,1,1,1,1,1,1,1,1,1,1,1];break}return res}})});steal("jquery/class",function($){$.Class("CE.Selectable",{myThis:null,scrollY:0,focusFlag:false,blurFlag:false,setScrollY:function(y){CE.Selectable.scrollY=y},focusWithoutScroll:function(el){if(!CE.Selectable.focusFlag){CE.Selectable.focusFlag=true;el.focus();window.scrollTo(0,CE.Selectable.scrollY);var t=setTimeout(function(){CE.Selectable.focusFlag=false;clearTimeout(t)},0)}return el},blurWithoutScroll:function(el){if(!CE.Selectable.blurFlag){CE.Selectable.blurFlag=true;el.blur();window.scrollTo(0,CE.Selectable.scrollY);var t=setTimeout(function(){CE.Selectable.blurFlag=false;clearTimeout(t)},0)}return el}},{selectedClass:"motopress-selected",init:function(){CE.Selectable.myThis=this;$(document).mousedown(function(){CE.Selectable.setScrollY(window.scrollY)});$(document).mouseup(function(){CE.Selectable.setScrollY(window.scrollY)});this.makeSelectable()},makeSelectable:function(){$(".motopress-content-wrapper").on("click",".motopress-drag-handle",function(){if($(this).hasClass(CE.Selectable.myThis.selectedClass)){if($(this).closest('[class*="mp-span"]').hasClass("ce_controls")&&!CE.Dialog.myThis.element.dialog("isOpen")){CE.Dialog.myThis.open($(this))}}else{CE.Selectable.myThis.select($(this))}CE.Selectable.focusWithoutScroll($(this).prev())});$(".motopress-content-wrapper").on("keydown",".motopress-focus-area",function(e){if($(this).next().hasClass(CE.Selectable.myThis.selectedClass)){if(e.which===$.ui.keyCode.ESCAPE){CE.Selectable.setScrollY(window.scrollY);CE.Selectable.myThis.unselect()}else{if(e.which===$.ui.keyCode.DELETE||e.which===$.ui.keyCode.BACKSPACE){e.preventDefault();CE.Selectable.setScrollY(window.scrollY);CE.Tools.myThis.removeBlock();parent.CE.Save.changeContent()}}}});$(document).on("click",function(e){if(!$(e.target).hasClass(CE.Selectable.myThis.selectedClass)&&!$(e.target).closest("."+CE.Dialog.myThis.dialogClass).length&&!CE.InlineEditor.isTinymce(e)){CE.Selectable.myThis.unselect()}})},select:function(el){if(CE.DragDrop.interruptInsert===false){this.unselect();CE.Selectable.focusWithoutScroll(el.prev());el.addClass(this.selectedClass).closest(".motopress-helper").nextAll(".ui-resizable-handle").show();parent.CE.Navbar.myThis.showObjectControlBtns();if(el.closest('[class*="mp-span"]').hasClass("ce_controls")&&!CE.Dialog.myThis.element.dialog("isOpen")){CE.Dialog.myThis.open(el)}}CE.DragDrop.interruptInsert=false},unselect:function(){var selected=$('.motopress-content-wrapper [class*="span"] .'+this.selectedClass);if(selected.length){selected.each(function(){$(this).removeClass(CE.Selectable.myThis.selectedClass).closest(".motopress-helper").nextAll(".ui-resizable-handle").hide()});parent.CE.Navbar.myThis.hideObjectControlBtns();if(CE.Dialog.myThis.element.dialog("isOpen")){CE.Dialog.myThis.element.dialog("close")}if(CE.InlineEditor.curElement){CE.InlineEditor.curElement.controller().close()}CE.Selectable.blurWithoutScroll(selected.prev())}}})});